---
title: 06-动态路由选择原理 距离矢量路由协议RIP
date: 2077-07-26
article: false
---

## 路由协议的分类

- 静态路由

  由管理员根据数据访问需求手工在每台设备上进行添加和维护。

- 动态路由

  路由器自动进行路由信息的更新和同步，并且当网络拓扑变更时能够自动收敛



## 动态路由协议分类

![img](https://s2.loli.net/2022/02/13/IObAM7gS54BsRtW.jpg)



## 距离矢量路由

 使用距离矢量路由协议的路由器并不了解到达目的网络的整条路径。该路由器只知道：

- 自身与目的网络之间的距离
- 应该往哪个方向或使用哪个接口转发数据包

特点：

- 周期性的更新（广播）整张路由表
- 与相邻的路由器交换路由表

### Metric 度量值

以跳数作为度量值，会优先选择度量值小的路由。次优的会隐藏在后台，当度量值相等会进行负载均衡。

### 管理距离（AD值）

当度量值相同时，会优先选择管理距离小的路由。

| Routing Protocol     | AD   | 备注       |
| -------------------- | ---- | ---------- |
| 直连接口             | 0    |            |
| 关联出接口的静态路由 | 1    | Metric = 0 |
| 关联下一跳的静态路由 | 1    | Metric = 0 |
| EIGRP 汇总路由       | 5    |            |
| 外部 BGP             | 20   |            |
| 内部 EIGRP           | 90   |            |
| IGRP                 | 100  |            |
| OSPF                 | 110  |            |
| RIP v1 / v2          | 120  |            |
| 外部 EIGRP           | 170  |            |
| 内部 BGP             | 200  |            |

### 依据传闻的更新（广播、更新路由表）

有隐患 不可靠

#### 环路产生

当交换路由表的时候网络发生变更（其中某个网段down了），可能会导致路由表出现环路。

#### 消除环路

- 定义最大跳数

  当路由表环路次数达到跳数上限即可自动终止环路，缺点是当网络中有很多个路由器数量的时候，跳数上线会很大；

- 水平分割 Split Horizon

  当收到某个路由更新时不会再向这个路由发送同样的路由信息；

- 路由中毒 Route Poisoning

  当路由器的某个网段down了后，立刻将此网段在路由表中的跳数标记为 Infinity（不可搭）然后将此路由表广播出去。此时远端路由器收到这个网段的不可达消息后便会将此网段隐藏（标记为Possibily Down），如果down时间过长则会将其删除，一定时间内恢复则会重新放进路由表；

- 毒性反转 Poison Reverse

  当远端网络收到了某个网段down的消息后，会返回一个路由表，表示等待此网络恢复；

- 抑制计时器 Hold-Down Timers

  为正在重新收敛的网络增加了应变能力

  引入了某种程度的怀疑量

  当某个网络down或路由出现变动，不立刻更新路由而是启动一个计时器。在未超时内仍然按照旧的路由执行，超时后再更新路由表。相当于在路由种引入一种“怀疑”，一种延迟机制；

- 触发更新 Triggered Update

  拓扑发生变更时，路由器立刻发送更新消息，而不等更新计时器超时，避免错位导致环路产生

## RIP的配置

### 概述

- RIP（Routing Information Protocol，路由信息协议）是应用较早、使用较普遍的内部网关协议（Interior Gateway Protocol，简称 IGP）
- 适用于小型同类网络，是典型的距离矢量协议
- RIP是基于UDP，端口520的应用层协议
- 管理距离（AD）：120

### 配置RIP

启动路由选择进程：

```
Router(config)# router rip
```

宣告直连网段（接口）：

```
Router(config-router)# network <直连接口网段>
```

